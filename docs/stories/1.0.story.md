# Story 1.0: Testing Infrastructure & Development Environment Setup

**Status:** Draft  
**Epic:** 1 - Content Foundation & Campaign Management (MVP Foundation)  
**Story ID:** 1.0  
**Created:** 2024-12-19  
**Last Updated:** 2024-12-19

## Story Statement

As a development team,  
I want comprehensive testing infrastructure established,  
so that all subsequent stories can be developed with proper test coverage and quality assurance.

## Acceptance Criteria

1. Jest and React Testing Library configured for component testing
2. Supabase local development environment setup for database testing
3. n8n integration documentation created (n8n workflows developed externally)
4. Test database seeding and cleanup utilities created
5. Integration test framework for AI service mock responses
6. CI/CD pipeline updated to run tests before deployment
7. Self-hosted n8n instance setup for external workflow development

## Integration Verification

- **IV1**: Test suite runs successfully in local and CI environments

  - All Jest tests pass with exit code 0 in local development
  - CI/CD pipeline executes tests successfully without errors
  - Test coverage meets minimum 80% threshold
  - Test execution time remains under 5 minutes for full suite

- **IV2**: Mock services provide realistic responses for development

  - n8n workflows access Supabase database directly (no webhooks needed)
  - Mock AI service responses include realistic content generation data
  - Mock responses include proper error scenarios for testing edge cases
  - Response times simulate real service behavior (100-500ms latency)

- **IV3**: Database testing doesn't interfere with production data

  - Test database uses separate schema or isolated environment
  - All test data is automatically cleaned up after test execution
  - No test operations affect production database tables
  - Test database connection uses different credentials from production

- **IV4**: Self-hosted n8n instance properly configured for external workflow development
  - n8n instance accessible via localhost with proper authentication
  - Database connection configured for direct Supabase access
  - Workflow execution logs are available for debugging
  - n8n instance can be started/stopped programmatically for testing

## Dev Notes

### Previous Story Insights

No previous stories exist - this is the first story in the project.

### Data Models

[Source: architecture/data-models.md#campaign]

- **Campaign**: Core entity for LinkedIn marketing contexts with target audience, messaging tone, and content themes
- **ContentItem**: Core content entity with pipeline state management, delegating versioning to separate table
- **ContentVersion**: Stores all versions of content as it evolves through AI generation and human editing
- **WorkflowExecution**: Tracks n8n workflow executions for AI content generation with audit trail

### Database Schema

[Source: architecture/database-schema.md#database-schema]

- PostgreSQL schema optimized for Supabase with Row Level Security
- Required extensions: uuid-ossp, pg_cron
- Tables: campaigns, content_items, content_versions, workflow_executions, content_performance, user_preferences
- RLS policies for user data isolation
- Optimized indexes for content pipeline queries
- Materialized view for campaign performance summary

### API Specifications

[Source: architecture/api-specification.md#rest-api-specification]

- REST API endpoints for campaigns and content CRUD operations
- Standardized response format: `{ data?, error?, message? }`
- Authentication via Supabase JWT tokens
- Webhook endpoints for n8n integration

### File Locations

[Source: architecture/unified-project-structure.md#unified-project-structure]

- Database migrations: `supabase/migrations/`
- API routes: `app/api/campaigns/`, `app/api/content/`
- Type definitions: `types/database.ts`, `types/content.ts`, `types/campaigns.ts`
- Database layer: `lib/database/repositories/`
- Services: `lib/services/campaign-service.ts`, `lib/services/content-service.ts`

### Testing Requirements

[Source: architecture/testing-strategy.md#brownfield-testing-approach]

- Comprehensive regression testing to ensure existing functionality remains intact
- Database schema regression protection tests
- API regression protection tests
- Performance regression protection tests
- Unit tests for new database operations
- Integration tests for API endpoints

### Testing

**Test File Location**: `__tests__/` directory following existing project structure

- Component tests: `__tests__/components/`
- Hook tests: `__tests__/hooks/`
- Utility tests: `__tests__/lib/`
- Integration tests: `__tests__/integration/`

**Testing Frameworks and Patterns**:

- Jest 29.0+ for test runner and assertions
- React Testing Library 16.0+ for component testing
- Supertest 7.0+ for API endpoint testing
- Playwright 1.48+ for E2E testing (future stories)

**Testing Standards**:

- Minimum 80% code coverage for new testing infrastructure
- All tests must run in both local and CI environments
- Mock services must provide realistic responses
- Database tests must not interfere with production data
- Test cleanup must be automatic and reliable

**Specific Testing Requirements for This Story**:

- Jest configuration must support TypeScript and React components
- Supabase local environment must be isolated from production
- n8n workflows access database directly (no webhooks needed)
- CI/CD pipeline must fail on test failures
- Self-hosted n8n instance must be properly configured for development

### Technical Constraints

[Source: architecture/coding-standards.md#critical-fullstack-rules]

- Type sharing: Define shared types in `types/` directory
- API response format: Standardized `{ data?, error?, message? }` structure
- Environment variables: Access only through validated config objects
- Database operations: Use repository pattern through `lib/database/repositories/`
- Real-time subscriptions: Properly cleanup Supabase subscriptions
- Content versioning: All content modifications must create new version records
- Campaign context: All content operations must validate campaign ownership through RLS policies

## Tasks / Subtasks

### Task 1: Jest and React Testing Library Setup (AC: 1)

1. Install Jest and React Testing Library dependencies
2. Configure Jest configuration for component testing
3. Set up test environment configuration
4. Create test utilities and helpers
5. Configure test database connection
6. Set up test data seeding utilities
7. Create test cleanup utilities

### Task 2: Supabase Local Development Environment (AC: 2)

1. Set up Supabase local development environment
2. Configure database connection for testing
3. Set up test database seeding
4. Create test database cleanup utilities
5. Configure database migration for testing
6. Set up test data seeding utilities

### Task 3: n8n Integration Documentation (AC: 3)

1. Create n8n integration documentation
2. Document database connection requirements
3. Document required table access
4. Document workflow specifications
5. Create n8n configuration guidelines
6. Document security considerations
7. Create workflow development guidelines

### Task 4: Integration Test Framework (AC: 5)

1. Set up integration test framework for AI service mocks
2. Create mock AI service responses
3. Configure AI service mock responses
4. Set up integration test utilities
5. Create AI service response validation
6. Set up AI service error handling
7. Configure AI service mock responses

### Task 5: CI/CD Pipeline Updates (AC: 6)

1. Update CI/CD pipeline to run tests before deployment
2. Configure test execution in CI/CD pipeline
3. Set up test reporting in CI/CD pipeline
4. Configure test coverage reporting
5. Set up test failure handling in CI/CD
6. Configure test notification system
7. Set up test result reporting

### Task 6: Self-hosted n8n Instance Setup (AC: 7)

1. Set up self-hosted n8n instance for development
2. Configure n8n instance connection
3. Set up n8n webhook configuration
4. Configure n8n workflow execution
5. Set up n8n workflow testing
6. Configure n8n workflow validation
7. Set up n8n workflow error handling

### Task 7: Unit Testing (AC: 1, 2, 3, 4, 5, 6, 7)

1. Create unit tests for Jest and React Testing Library setup (AC: 1)
2. Create unit tests for Supabase local development environment (AC: 2)
3. Create unit tests for mock n8n webhook endpoints (AC: 3)
4. Create unit tests for integration test framework (AC: 5)
5. Create unit tests for CI/CD pipeline updates (AC: 6)
6. Create unit tests for self-hosted n8n instance setup (AC: 7)
7. Ensure test coverage meets project standards (AC: 1-7)

### Task 8: Integration Testing (AC: 1, 2, 3, 4, 5, 6, 7)

1. Create integration tests for Jest and React Testing Library setup (AC: 1)
2. Create integration tests for Supabase local development environment (AC: 2)
3. Create integration tests for mock n8n webhook endpoints (AC: 3)
4. Create integration tests for integration test framework (AC: 5)
5. Create integration tests for CI/CD pipeline updates (AC: 6)
6. Create integration tests for self-hosted n8n instance setup (AC: 7)
7. Test integration between all testing components (AC: 1-7)

### Task 9: Documentation and Cleanup

1. Update API documentation with new testing endpoints
2. Document database schema changes for testing
3. Update development setup instructions
4. Clean up any temporary files
5. Verify all tests pass
6. Update story status to "Ready for Review"

## Project Structure Notes

The implementation follows the unified project structure defined in the architecture documentation. All new files will be placed according to the established patterns:

- Database migrations in `supabase/migrations/`
- API routes in `app/api/` following RESTful conventions
- Type definitions in `types/` directory
- Repository layer in `lib/database/repositories/`
- Services in `lib/services/`

## Change Log

| Date       | Version | Description                                                        | Author        |
| ---------- | ------- | ------------------------------------------------------------------ | ------------- |
| 2024-12-19 | 1.0     | Initial story creation                                             | Product Owner |
| 2024-12-19 | 1.1     | Added comprehensive testing section and Dev Agent Record structure | Product Owner |

## File List

_This section will be updated by the Developer Agent during implementation_

## Dev Agent Record

### Agent Model Used

_This section will be updated by the Developer Agent during implementation_

### Debug Log References

_This section will be updated by the Developer Agent during implementation_

### Completion Notes List

_This section will be updated by the Developer Agent during implementation_

### File List

_This section will be updated by the Developer Agent during implementation_

## QA Results

_This section will be updated by the QA Agent during review_
